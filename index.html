<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>BirlaOne - Dashboard</title>
  <link rel="icon" type="image/png" href="https://fuovcuzaxfkyqrridrgy.supabase.co/storage/v1/object/public/profile-pics//study-icon-modified.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; background: linear-gradient(180deg,#f5f5f7,#e9e9ed); }
    header { background: #8f00ff; color: white; padding: 15px; text-align: center; }
    .container { display: flex; }
    aside { width: 220px; background: #2a2a3d; color: white; min-height: 100vh; padding: 20px; }
    aside h3 { margin-top: 0; }
    main { flex: 1; padding: 20px; }
    .profile-card { text-align:center; margin:20px auto; padding:20px; max-width:400px; background:white; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    .profile-card img { width:90px; height:90px; border-radius:50%; border:2px solid #b84fff; margin-bottom:15px; }
    .logout-btn { margin-top:20px; padding:10px 16px; background:#ef5350; border:none; border-radius:8px; color:white; font-weight:600; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>BirlaOne Dashboard</h1>
  </header>
  <div class="container">
    <aside>
      <h3>Menu</h3>
      <ul>
        <li><a href="#">Profile</a></li>
        <li><a href="#">Confessions</a></li>
        <li><a href="#">Replies</a></li>
        <li><a href="#">Notifications</a></li>
      </ul>
    </aside>
    <main>
      <!-- Profile Section -->
      <div class="profile-card" id="profileCard">
        <img id="profilePic" src="" alt="Profile Picture"/>
        <h2 id="profileName">Loading...</h2>
        <p id="profileCourse"></p>
        <p id="profileEmail"></p>
        <p><strong>Student ID:</strong> <span id="profileId"></span></p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>

      <!-- Future features go here (confessions, replies, etc.) -->
      <section id="features">
        <h3>Coming Features</h3>
        <p>Your confessions, replies, and notifications will load here.</p>
      </section>
    </main>
  </div>

  <script>
    // --- Supabase Setup ---
    const SUPABASE_URL = "https://eikriuddsuguybvvyzjl.supabase.co";
    const SUPABASE_KEY = "YOUR_ANON_KEY"; // ‚ö†Ô∏è replace with your anon key
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- Cookie Utility ---
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(\`; ${name}=\`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function logout() {
      document.cookie = "id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      supabase.auth.signOut();
      window.location.href = "login.html";
    }

    // --- Secure Page Load ---
    async function loadProfile() {
      const studentId = getCookie("id");
      if (!studentId) {
        window.location.href = "login.html"; // üîí Not logged in
        return;
      }

      // Fetch profile
      const { data, error } = await supabase
        .from("users")
        .select("id, name, email, course, img")
        .eq("id", parseInt(studentId))
        .single();

      if (error || !data) {
        console.error("Error fetching profile:", error);
        alert("Session expired. Please login again.");
        logout();
        return;
      }

      // --- Fill UI ---
      document.getElementById("profilePic").src = data.img || "https://t4.ftcdn.net/jpg/05/89/93/27/360_F_589932782_vQAEAZhHnq1QCGu5ikwrYaQD0Mmurm0N.jpg";
      document.getElementById("profileName").innerText = data.name || "Student";
      document.getElementById("profileCourse").innerText = data.course ? "Course: " + data.course : "";
      document.getElementById("profileEmail").innerText = data.email || "";
      document.getElementById("profileId").innerText = data.id;
    }

    document.addEventListener("DOMContentLoaded", loadProfile);
  </script>
</body>
</html>
