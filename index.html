<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supabase Debug</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Debug Page</h1>
  <pre id="output">Loading...</pre>

<script>
const SUPABASE_URL = "https://eikriuddsuguybvvyzjl.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ANON_KEY_HERE";  // replace with your anon key
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(";").shift();
}

async function debugCheck() {
  const out = document.getElementById("output");

  console.log("üîé Checking Supabase session...");
  const { data: { session }, error: sessErr } = await supabase.auth.getSession();
  console.log("Session result:", session, sessErr);

  let profile = null;

  if (session?.user) {
    console.log("‚úÖ Session found. Trying auth_id lookup:", session.user.id);
    const { data, error } = await supabase
      .from("users")
      .select("id, name, email, mob, role, auth_id")
      .eq("auth_id", session.user.id)
      .single();
    console.log("Auth_id query result:", data, error);
    if (!error && data) profile = data;
  }

  if (!profile) {
    const studentId = getCookie("id");
    console.log("‚ö†Ô∏è auth_id fetch failed. Cookie ID:", studentId);
    if (studentId) {
      const { data, error } = await supabase
        .from("users")
        .select("id, name, email, mob, role, auth_id")
        .eq("id", parseInt(studentId, 10))
        .single();
      console.log("Cookie query result:", data, error);
      if (!error && data) profile = data;
    }
  }

  if (!profile) {
    out.textContent = "‚ùå No profile found. (We will NOT redirect here)";
    console.log("‚ùå No profile found. Debug stop here, no redirect.");
    return;
  }

  out.textContent = "‚úÖ Profile loaded:\n\n" + JSON.stringify(profile, null, 2);
  console.log("‚úÖ Profile loaded:", profile);
}

debugCheck();
</script>
</body>
</html>
